---
meta:
  title: How to revoke a kubeconfig of a Kapsule cluster
  description: This page explains how to revoke a kubeconfig of a Kapsule cluster
content:
  h1: How to revoke a kubeconfig of a Kapsule cluster
  paragraph: This page explains how to revoke a kubeconfig of a Kapsule cluster
tags: kubernetes kubernetes-kapsule kapsule cluster kubeconfig revoke iam
dates:
  validation: 2023-11-28
  posted: 2023-11-28
categories:
  - kubernetes
---

<Macro id="iam-requirements" />

<Message type="requirement">
  - You have an account and are logged into the [Scaleway console](https://console.scaleway.com)
  - You have [created](/containers/kubernetes/how-to/create-cluster) a Kubernetes Kapsule cluster
</Message>

By the end of 2023, a new Authentication (Auth) system, based on IAM tokens, is introduced. **This results in the coexistence of two authentication mechanisms.**

Previously, users were limited to static admin tokens provisioned by Kapsule.

In the new system, when a user loses access rights (e.g., leaves the organization), the Kubernetes administrator can simply modify the IAM group, edit its policy, or remove the user to revoke cluster access.
This approach is a derivation from the previous method, where the owner had to reset the admin token, impacting all other users and requiring actions through the Console, CLI, or API methods.
Now, users have the alternative option of using a key provisioned by IAM for authentication.

## How to revoke a kubeconfig file with IAM

To revoke cluster access, you can have to ensure that the API key associated with it is no longer granted permission.

Any of the following IAM modifications will restrict access:

1. Delete the API key.
2. Modify its policy to limit permissions.
3. Transfer the principal to a different group with fewer permissions.
4. Delete the principal (application or user).

To permanently revoke kubeconfig access with IAM, either delete the corresponding API key or delete the principal.

## How to reset the admin token of a cluster (deprectated)

<Message type="note">
    Keep in mind that this method is deprecated and is no longer available from the Scaleway console. You can perform these actions using the CLI/API only.
</Message>

You have the option to reset the admin token, thereby invalidating all associated legacy kubeconfig files, through one of the following methods:

<Message type="important">
  Exercise caution as this action will restart the cluster control plane and revoke the admin authentication token. Consequently, users will no longer be able to generate legacy kubeconfig files using an admin token (deprecated, replaced by IAM).
</Message>

### Using the CLI

Run the following command to remove the admin token from a cluster:

```sh
scw k8s cluster reset-admin-token <cluster-id> region=<scw-region>
```
Remember to replace `<cluster-id>` with the ID and `<scw-region>` with the region of your Kubernetes Kapsule cluster.

### Using the API

Refer to the developers documentation: [Resetting the Admin Token of a Cluster](https://www.scaleway.com/en/developers/api/kubernetes/#path-clusters-reset-the-admin-token-of-a-cluster)

<Navigation title="See Also">
  <PreviousButton to="/containers/kubernetes/how-to/connect-cluster-kubectl/">How to connect to a cluster with kubectl</PreviousButton>
  <NextButton to="/containers/kubernetes/how-to/deploy-image-from-container-registry/">How to deploy an image from Container Registry</NextButton>
</Navigation>
